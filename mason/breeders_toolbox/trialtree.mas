
<%args>
@locations => ()
@roles => ()
$breeding_programs
</%args>

<& /util/import_javascript.mas, classes => [ 'jquery.iframe-post-form','CXGN.BreedersToolbox.AddTrial','CXGN.BreedersToolbox.UploadTrial','CXGN.BreedersToolbox.Trial', 'jstree.dist.jstree' ] &>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Information</th>
      <th>Breeding Programs -- -- Trials</th>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td>
      <h4>Download Trial</h4>
      <button class="btn btn-primary" id="download_button" disabled="disabled" title="First Select a Trial to Download">Excel</button>
      <button class="btn btn-primary" id="download_button_csv" disabled="disabled" title="First Select a Trial to Download">CSV</button><br />
      <hr>
      <h5><i>Double click<br />trial to view</i></h5>
      <!-- hr>
      <button id="delete" disabled="disabled" >Delete</button -->
      <br />
    </td>
    <td>
      <div id="trial_list" >[loading...]</div>
    </td>
  </tr>
  </tbody>
</table>

<script>

  jQuery.noConflict(); 

  jQuery(document).ready(function($) {  
    
    jQuery.ajax( { 
      url: '/ajax/breeders/get_trials',
      success: function(response) { 
        var html = format(response);
        jQuery('#trial_list').html(html);
        jQuery('#trial_list').jstree();

      },
      error: function(response) { 
        alert("An error occurred");
      }
  });

  function format(s) { 
    var html = "<ul>";
    for (var k in s) { 
      if(s.hasOwnProperty(k)) { 
        html += "<li>"+ k;
        if (s[k] !== null) { 
          html += '<ul>';
          for (var n=0; n<s[k].length; n++) { 
       
            html += '<li id="'+s[k][n][0]+'">'+s[k][n][1]+"</li>";

          }
          html += '</ul>';
        }

      }
        html += '</li>';
    }
    html += "</ul>";
     return html;

   }

     $('#trial_list').on("changed.jstree", function (e, data) {
       if ($('#trial_list').jstree('is_leaf', data.node)) { 
         $('#download_button').removeAttr('disabled');
         $('#download_button_csv').removeAttr('disabled');
       }
       else { 
         $('#download_button').attr('disabled', 'disabled');
         $('#download_button_csv').attr('disabled', 'disabled');
       }
	 
       
         // }
    });				      

    $('#download_button').on('click', function () {
        var selected = $('#trial_list').jstree('get_bottom_selected');
        if (selected.length !== 0) { 
	  window.open('/breeders/trials/phenotype/download/'+selected.join(","));
        }
        else { alert("No leaf nodes selected for download."); }
       
    });

    $('#download_button_csv').on('click', function () {
        var selected = $('#trial_list').jstree('get_bottom_selected');
        if (selected.length !== 0) { 
	  window.open('/breeders/trials/phenotype/download/'+selected.join(",")+'?format=csv');
        }
        else { alert("No leaf nodes selected for download."); }
       
    });

    $("#trial_list").delegate("li", "dblclick", function(){ 
      var node = $("#trial_list").jstree("get_node", this); 
      if ($('#trial_list').jstree('is_leaf', node)) { 				       
        window.open('/breeders_toolbox/trial/'+node.id);
      }
    }); 
  });
  
</script>

<div class="modal fade" id="add_project_dialog" name="add_project_dialog" tabindex="-1" role="dialog" aria-labelledby="addProjectDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addProjectDialog">Add New Trial</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <form class="form-horizontal" role="form" method="post" enctype="multipart/form-data" encoding="multipart/form-data" id="create_new_trial_form" name="create_new_trial_form">
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Trial Name: </label>
      	      <div class="col-sm-9">
		<input class="form-control" id="new_trial_name" name="new_trial_name" type="text" />
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Year(s): </label>
      	      <div class="col-sm-9">
		<input class="form-control" id="add_project_year" name="add_project_year" type="text" />
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Location: </label>
      	      <div class="col-sm-9">
		<select class="form-control" id="add_project_location" name="add_project_location">
      		<%perl>foreach my $location (@locations) { print "
      		  <option value=".'"'.@$location[1].'"'.">".@$location[1]."</option>"; }
      		</%perl>
    		</select>
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Breeding Program: </label>
      	      <div class="col-sm-9">
		<select class="form-control" id="select_breeding_program" name="select_breeding_program">
      		<%perl>foreach my $program (@$breeding_programs) {
         	  print "<option value=".@$program[1].">".@$program[1]."</option>"; }
      		</%perl>
    		</select>
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Description: </label>
      	      <div class="col-sm-9">
	        <textarea class="form-control" id="add_project_description" name="add_project_description" form="create_new_trial_form" ></textarea>
              </div>
	    </div>
	    <div id="format_type_radio" style="display: none">
	      <div class="form-group">
      	        <label class="col-sm-2 control-label">Create Using Trial Design Tool: </label>
      	        <div class="col-sm-10">
	          <input type="radio" class="format_type" id="format_radio3" name="radio" value="create_with_design_tool" checked="checked" />
                </div>
	      </div>
	      <div class="form-group">
      	        <label class="col-sm-2 control-label">Create From Uploaded File: </label>
      	        <div class="col-sm-10">
	          <input type="radio" class="format_type" id="format_radio2" name="radio" value="create_with_upload" />
                </div>
	      </div>
	      <div class="form-group">
      	        <label class="col-sm-2 control-label">Create Empty Trial: </label>
      	        <div class="col-sm-10">
	          <input type="radio" class="format_type" id="format_radio1" name="radio" value="empty" />
                </div>
	      </div>
	    </div>
	    <div id="get_file_upload_data" style="display: none">
	      <div class="form-group">
      	        <label class="col-sm-2 control-label">Upload File: </label>
      	        <div class="col-sm-10">
	          <input type="file" name="trial_upload_file" id="trial_upload_file" encoding="multipart/form-data" />
                </div>
	      </div>
	    </div>
	    <div id="trial_design_info" style="display: none">
	      <hr>
	      <div class="form-group">
      	        <label class="col-sm-3 control-label">Design Type: </label>
      	        <div class="col-sm-9">
	          <select class="form-control" id="select_design_method" name="select_design_method">
		    <option value=CRD>Completely Randomized</option>
        	    <option value=RCBD>Complete Block</option>
        	    <option value=Alpha>Alpha Lattice</option>
        	    <option value=Augmented>Augmented</option>
		    <option value=MAD>Modified Augmented Design </option>

		    <!--<option value=MADIII>MADIII</option>-->
		    <!--<option value=MADIV>MADIV</option>-->
       		    <!--<option value=MADV>MADV</option>-->
      		  </select>
                </div>
	      </div>
	    </div>
	    <div id="trial_design_more_info" style="display: none">
	      <div class="form-group form-group-sm" >
      	        <label class="col-sm-7 control-label">List of Stocks to Include (Required): <br/><button name="lists_link" class="btn btn-info btn-sm" style="margin:6px 0px 0px 0px" type="button" >Manage Lists</button></label>
      	        <div class="col-sm-5" id="select_list" name="select_list">
                </div>
	      </div>
	      <div class="form-group form-group-sm" id="show_list_of_checks_section" style="display: none" >
      	        <label class="col-sm-7 control-label">List of Checks to Include (Required): </label>
      	        <div class="col-sm-5" id="list_of_checks_section" >
                </div>
	      </div>
	      <div id="design_info" name="design_info">
	        <div class="form-group form-group-sm" id="rep_count_section" style="display: none">
      	          <label class="col-sm-7 control-label">Number of Replicates (Required): </label>
      	          <div class="col-sm-5" >
		    <input class="form-control" id="rep_count" name="rep_count" />
                  </div>
	        </div>
		<div class="form-group form-group-sm" id="block_number_section" style="display: none">
      	          <label class="col-sm-7 control-label">Number of Blocks (Required): </label>
      	          <div class="col-sm-5" >
		    <input class="form-control" id="block_number" name="block_number" />
                  </div>
	        </div>
		<div class="form-group form-group-sm" id="row_number_section" style="display: none">
      	          <label class="col-sm-7 control-label">Number of Field Rows (Required): </label>
      	          <div class="col-sm-5" >
		    <input class="form-control" id="row_number" name="row_number" />
                  </div>
	        </div>
		<div class="form-group form-group-sm" id="row_number_per_block_section" style="display: none">
      	          <label class="col-sm-7 control-label">Number of Rows Per Block (Optional): </label>
      	          <div class="col-sm-5" >
		    <input class="form-control" id="row_number_per_block" name="row_number_per_block" />
                  </div>
	        </div>
		<div id="other_parameter_section" style="display:none">
		  <hr>
		  <div class="form-group">
      	            <label class="col-sm-4 control-label">Show Optional Parameters: </label>
      	            <div class="col-sm-8" >
		      <input type="checkbox" id="show_other_parameter_options" />
                    </div>
	          </div>
		  <div id="other_parameter_options" style="display:none">
		    <div class="form-group form-group-sm">
      	              <label class="col-sm-7 control-label">Column Number Per Block: </label>
      	              <div class="col-sm-5" >
		        <input type="text" class="form-control" id="col_number_per_block" name="col_number_per_block" />
                      </div>
	            </div>
		    <div class="form-group form-group-sm">
      	              <label class="col-sm-7 control-label">Number of Field Columns: </label>
      	              <div class="col-sm-5" >
		        <input type="text" class="form-control" id="col_number" name="col_number" />
                      </div>
	            </div>
		  </div>
		</div>
		<div class="form-group form-group-sm" id="block_size_section" style="display: none">
      	          <label class="col-sm-7 control-label">Block Size (Required): </label>
      	          <div class="col-sm-5" >
		    <input type="text" class="form-control" id="block_size" name="block_size" />
                  </div>
	        </div>
		<div class="form-group form-group-sm" id="max_block_size_section" style="display: none">
      	          <label class="col-sm-7 control-label">Maximum Block Size (Required): </label>
      	          <div class="col-sm-5" >
		    <input type="text" class="form-control" id="max_block_size" name="block_size" />
                  </div>
	        </div>
		<hr>
		<div class="form-group" >
      	          <label class="col-sm-4 control-label">Custom Plot Naming/Numbering: </label>
      	          <div class="col-sm-8" >
		    <input type="checkbox" id="show_plot_naming_options" />
                  </div>
	        </div>
		<div id="plot_naming_options" style="display: none">
		  <div class="form-group form-group-sm" >
      	            <label class="col-sm-7 control-label">Plot Prefix: </label>
      	            <div class="col-sm-5" >
		      <input type="text" class="form-control" id="plot_prefix" name="plot_prefix" />
                    </div>
	          </div>
		  <div class="form-group form-group-sm" >
      	            <label class="col-sm-7 control-label">Plot Start Number: </label>
      	            <div class="col-sm-5" >
		      <input type="text" class="form-control" id="start_number" name="start_number" />
                    </div>
	          </div>
		  <div class="form-group form-group-sm" >
      	            <label class="col-sm-7 control-label">Plot Number Increment: </label>
      	            <div class="col-sm-5" >
		      <input type="text" class="form-control" id="increment" name="increment" />
                    </div>
	          </div>
		</div>
	      </div>
	    </div>
	  </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" name="new_trial_submit" id="new_trial_submit">Add Trial</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="add_project_dialog" class="ui-widget">
  <form method="post" enctype="multipart/form-data" encoding="multipart/form-data" id="create_new_trial_form" name="create_new_trial_form">
    <label for="new_trial_name" style="display: inline-block; width: 100px;">Trial name:</label>
    <input id="new_trial_name" name="new_trial_name" />
    <br>
    <label for="add_project_year" style="display: inline-block; width: 100px;">Year(s):</label>
    <input id="add_project_year" name="add_project_year" />
    <br>
    <label for="add_project_location" style="display: inline-block; width: 100px;">Location:</label>
    <select id="add_project_location" name="add_project_location">
      <%perl>foreach my $location (@locations) { print "
      <option value=".'"'.@$location[1].'"'.">".@$location[1]."</option>"; }
      </%perl>
    </select>
    <br>
    <label for="select_breeding_program" style="display: inline-block; width: 100px;">Breeding Program:</label>
    <select id="select_breeding_program" name="select_breeding_program">
      <%perl>
      foreach my $program (@$breeding_programs) {
         print "<option value=".@$program[1].">".@$program[1]."</option>";
      }
      </%perl>
    </select>
    <br>

    <label for="add_project_description" style="display: inline-block; vertical-align:top; width: 100px;">Description:</label>
    <textarea id="add_project_description" name="add_project_description" form="create_new_trial_form" cols="40"></textarea>
    <div id="format_type_radio" style="display: none">
      <input type="radio" id="format_radio3" name="radio" class="format_type" value="create_with_design_tool" checked="checked" />
      <label for="radio3">Create using trial design tool</label>
      <br>
      <input type="radio" id="format_radio2" name="radio" class="format_type" value="create_with_upload" style="display: none"/>
      <label for="radio2" style="display: none">Create from uploaded file</label>
      <br>
      <input type="radio" id="format_radio1" name="radio" class="format_type" value="empty" style="display: none"/>
      <label for="radio1" style="display: none">Create empty trial</label>
      <br>
    </div>
    <div id="get_file_upload_data" style="display: none">
      <hr>
      <label for="trial_upload_file" style="display: inline-block; width: 100px;">Upload file:</label>
      <input type="file" name="trial_upload_file" id="trial_upload_file" encoding="multipart/form-data" />
    </div>


    <div id="trial_design_info" style="display: none">
      <hr>
      <label for="select_design_method" style="display: inline-block; width: 300px;">Design type:</label>
      <select id="select_design_method" name="select_design_method">
	<option value=CRD>Completely Randomized</option>
        <option value=RCBD>Complete Block</option>
        <option value=Alpha>Alpha Lattice</option>
        <option value=Augmented>Augmented</option>
	<option value=MAD>Modified Augmented Design </option>

	<option value=MADIII>MADIII</option>
	<option value=MADIV>MADIV</option>
       	<option value=MADV>MADV</option>
      </select>
      <br>
      <br>
      <br>


       <%doc>
       </%doc>

      <div id="trial_design_more_info" style="display: none">

      <div id="select_list" name="select_list">
	<label id="select_list_label" for="select_list_list_select" style="display: inline-block; width: 300px;">List of stocks to include:<br>
	(required parameter)
	</label>
      </div>

      <div id="list_of_checks_section" style="display: none">
	<label id="select_list_of_checks_label" for="select_list_of_checks_list_select" style="display: inline-block; width: 300px;">List of checks:<br>
	(required parameter) 
	</label>
      </div>

      <br>
      <div id="design_info" name="design_info">
	<div id="rep_count_section" style="display: none">
	  <label for="rep_count" style="display: inline-block; width: 300px;">Number of replicates:<br>
	    (required parameter)
	  </label>
	  <input id="rep_count" name="rep_count" />
	  <br>
	</div>

        <div id="block_number_section" style="display: none">
	  <label for="block_number" style="display: inline-block; width: 300px;">Number of blocks:<br>
	    (required parameter)
	  </label>
	  <input id="block_number" name="block_number" />
	  <br>
        </div>
       
	<div id="row_number_section" style="display: none">
	  <label for="row_number" style="display: inline-block; width: 300px;">Number of field rows:<br>
	    (required parameter)
	  </label>
	  <input id="row_number" name="row_number" />   
       	</div>
        <br>

	<div id="row_number_per_block_section" style="display: none">
	  <label for="row_number_per_block" style="display: inline-block; width: 300px;">Row Number Per Block:<br>
	    (Optional parameter)
	  </label>
	  <input id="row_number_per_block" name="row_number_per_block" />
	  <br>
        </div>

        <div id="other_parameter_section" style="display:none">  
     	<label for="show_other_parameter_options">Other optional parameters</label>
        <input type="checkbox" id="show_other_parameter_options">
 	<div id="other_parameter_options" style="display:none"> 
          <hr> 
     	  <label for="col_number_per_block" style="display: inline-block; width: 300px;">Col Number Per Block:</label>
	  <input id="col_number_per_block" name="col_number_per_block" />
	  <br>
	  <label for="col_number" style="display: inline-block; width: 300px;">Number of field columns:</label>
	  <input id="col_number" name="col_number" />
	  <br>
       	</div>
	</div>

        <div id="block_size_section" style="display: none">
	  <label for="block_size" style="display: inline-block; width: 300px;">Block size:<br>
	    (required parameter)
	  </label>
          <input id="block_size" name="block_size" />
	  <br>
        </div>

        <div id="max_block_size_section" style="display: none">
	  <label for="max_block_size" style="display: inline-block; width: 300px;">Maximum block size:<br>
	    (required parameter)
	  </label>
          <input id="max_block_size" name="block_size" />
	  <br>
	</div>


	<br>
	<label for="show_plot_naming_options">Custom plot naming/numbering</label>
        <input type="checkbox" id="show_plot_naming_options">

	<div id="plot_naming_options" style="display: none">
	  <hr>
	  <label for="plot_prefix" style="display: inline-block; width: 300px;">Plot name prefix:</label>
	  <input id="plot_prefix" name="plot_prefix" />
	  <br>
	  <label for="start_number" style="display: inline-block; width: 300px;">Plot start number:</label>
          <input id="start_number" name="start_number" />
	  <br>
	  <label for="increment" style="display: inline-block; width: 300px;">Plot number increment:</label>
          <input id="increment" name="increment" />
	  <br>
       </div>

     </div>
    </div>
    </div>
  </form>
</div>
-->

<div class="modal fade" id="upload_trial_error_display" name="upload_trial_error_display" tabindex="-1" role="dialog" aria-labelledby="uploadTrialErrorDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="uploadTrialErrorDialog">Errors In Uploaded File</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <table>
    	  <tbody></tbody>
  	  </table>
	</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="upload_trial_error_display" class="ui-widget">
  <table>
    <tbody></tbody>
  </table>
</div>
-->

<div class="modal fade" id="trial_design_confirm" name="trial_design_confirm" tabindex="-1" role="dialog" aria-labelledby="addTrialConfirmDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addTrialConfirmDialog">Confirm Trial Design</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <p><span class="ui-icon ui-icon-check"></span>Trial Is Valid<br>The following trial will be added</p>  
  	  <button class="btn btn-info btn-sm" id="view_trial_layout_button" >View Trial Layout</button> 
  	  <hr>
  	  <div id="trial_design_information">
	  </div>
	</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	<button type="button" class="btn btn-primary" name="new_trial_confirm_submit" id="new_trial_confirm_submit">Confirm</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="trial_design_confirm" title="Confirm trial design">
  <p><span class="ui-icon ui-icon-check"></span>Trial is valid<br>The following trial will be added</p>  
  <button id="view_trial_layout_button" class="ui-widget">View trial layout</button> 
  <hr>
  <div id="trial_design_information" class="ui-widget"></div>
</div>
-->

<div class="modal fade" id="trial_design_view_layout" name="trial_design_view_layout" tabindex="-1" role="dialog" aria-labelledby="addTrialDesignViewDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addTrialDesignViewDialog">Trial Design Layout</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <p><span class="ui-icon ui-icon-info"></span>Trial Layout</p>
	  <div id="trial_design_view_layout_return">
	  </div>
	</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="trial_design_view_layout" title="Trial design layout">
  <p><span class="ui-icon ui-icon-info"></span>Trial layout</p>
</div>
-->

<!--
<div id="trial_saving_dialog" title="Saving">
  <p>
    Saving trial<br>
    <span style="float: center;"><img src="/img/wheel.gif"/></span>
  </p>
</div>
-->

<style>
#progressbar .ui-progressbar-value {
background-color: #ccc;
}
</style>

<div class="modal fade" id="trial_saved_dialog_message" name="trial_saved_dialog_message" tabindex="-1" role="dialog" aria-labelledby="addTrialSavedDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addTrialSavedDialog">Trial Saved</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <p>
    	  <span class="ui-icon ui-icon-circle-check" style="float: left; margin: 0 7px 50px 0;"></span>
    	  The trial was saved successfully
  	  </p>
	</div>
      </div>
      <div class="modal-footer">
        <button id="trial_saved_dialog_message_ok_button" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="trial_saved_dialog_message" title="Trial saved">
  <p>
    <span class="ui-icon ui-icon-circle-check" style="float: left; margin: 0 7px 50px 0;"></span>
    The trial was saved successfully
  </p>
</div>
-->

<div class="modal fade" id="upload_trial_dialog" name="upload_trial_dialog" tabindex="-1" role="dialog" aria-labelledby="uploadTrialDialog">
  <div class="modal-dialog " role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="uploadTrialDialog">Upload Trial</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <&| /page/explanation.mas, title=>'Template information' &>
    	    <p>
      	    <b>File format information</b>
      	    <br>
      	    <a id="trial_upload_spreadsheet_format_info">Spreadsheet format</a>
    	    </p>
  	  </&>

	  <form class="form-horizontal" role="form" method="post" enctype="multipart/form-data" encoding="multipart/form-data" id="upload_trial_form" name="upload_trial_form">
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Breeding Program: </label>
      	      <div class="col-sm-9">
		<select class="form-control" id="trial_upload_breeding_program" name="trial_upload_breeding_program">
      		<%perl>
      		  foreach my $program (@$breeding_programs) {
         	    print "<option value=".@$program[1].">".@$program[1]."</option>";
      		  }
      		</%perl>
    		</select>
              </div>
	    </div>
	    <div class="form-group form-group-sm">
      	      <label class="col-sm-3 control-label">Location: </label>
      	      <div class="col-sm-9" >
		<select class="form-control" id="trial_upload_location" name="trial_upload_location">
      		<%perl>foreach my $location (@locations) { print "
        	  <option value=".'"'.@$location[1].'"'.">".@$location[1]."</option>"; }
      		</%perl>
    		</select>
              </div>
	    </div>
	    <div class="form-group form-group-sm">
      	      <label class="col-sm-3 control-label">Trial Name: </label>
      	      <div class="col-sm-9" >
		<input type="text" class="form-control" id="trial_upload_name" name="trial_upload_name" />
              </div>
	    </div>
	    <div class="form-group form-group-sm">
      	      <label class="col-sm-3 control-label">Year(s): </label>
      	      <div class="col-sm-9" >
		<input type="text" class="form-control" id="trial_upload_year" name="trial_upload_year" />
              </div>
	    </div>
	    <div class="form-group form-group-sm">
      	      <label class="col-sm-3 control-label">Description: </label>
      	      <div class="col-sm-9" >
		<textarea class="form-control" id="trial_upload_description" name="trial_upload_description" form="upload_trial_form" ></textarea>
              </div>
	    </div>
	    <div class="form-group form-group-sm">
      	      <label class="col-sm-3 control-label">Design Type: </label>
      	      <div class="col-sm-9" >
		<select class="form-control" id="trial_upload_design_method" name="trial_upload_design_method">
      		  <option value=CRD>Completely Randomized</option>
      		  <option value=RCBD>Complete Block</option>
      		  <option value=Alpha>Alpha Lattice</option>
      		  <option value=Augmented>Augmented</option>
      		  <option value=MAD>Modified Augmented Design</option>

    		  <!--  <option value=MADIII>MADIII</option>   -->
    		  <!--  <option value=MADIV>MADIV</option> -->
    		  <!--  <option value=MADV>MADV</option> -->
    		</select>
              </div>
	    </div>
	    <div class="form-group form-group-sm">
      	      <label class="col-sm-3 control-label">Upload File: </label>
      	      <div class="col-sm-9" >
		<input type="file" name="trial_uploaded_file" id="trial_uploaded_file" encoding="multipart/form-data" />
              </div>
	    </div>
	  </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" name="upload_trial_submit" id="upload_trial_submit">Upload Trial</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="upload_trial_dialog" title="Upload trial">

  <&| /page/explanation.mas, title=>'Template information' &>
    <p>
      <b>File format information</b>
      <br>
      <a id="trial_upload_spreadsheet_format_info">Spreadsheet format</a>
    </p>
  </&>

  <form method="post" enctype="multipart/form-data" encoding="multipart/form-data" id="upload_trial_form" name="upload_trial_form">

    <label for="trial_upload_breeding_program" style="display: inline-block; width: 100px;">Breeding Program:</label>
    <select id="trial_upload_breeding_program" name="trial_upload_breeding_program">
      <%perl>
      foreach my $program (@$breeding_programs) {
         print "<option value=".@$program[1].">".@$program[1]."</option>";
      }
      </%perl>
    </select>
    <br>

    <label for="trial_upload_location" style="display: inline-block; width: 100px;">Location:</label>
    <select id="trial_upload_location" name="trial_upload_location">
      <%perl>foreach my $location (@locations) { print "
        <option value=".'"'.@$location[1].'"'.">".@$location[1]."</option>"; }
      </%perl>
    </select>
    <br>

    <label for="trial_upload_name" style="display: inline-block; width: 100px;">Trial name:</label>
    <input id="trial_upload_name" name="trial_upload_name" />
    <br>

    <label for="trial_upload_year" style="display: inline-block; width: 100px;">Year(s):</label>
    <input id="trial_upload_year" name="trial_upload_year" />
    <br>

    <label for="trial_upload_description" style="display: inline-block; vertical-align:top; width: 100px;">Description:</label>
    <textarea id="trial_upload_description" name="trial_upload_description" form="upload_trial_form" cols="40"></textarea>
    <br>

    <label for="trial_upload_design_method" style="display: inline-block; width: 100px;">Design type:</label>
    <select id="trial_upload_design_method" name="trial_upload_design_method">
      <option value=CRD>Completely Randomized</option>
      <option value=RCBD>Complete Block</option>
      <option value=Alpha>Alpha Lattice</option>
      <option value=Augmented>Augmented</option>
      <option value=MAD>Modified Augmented Design</option>


    <option value=MADIII>MADIII</option> 
    <option value=MADIV>MADIV</option> 
    <option value=MADV>MADV</option> 
    </select>
    <br>
    <br>

    <label for="trial_uploaded_file" style="display: inline-block; width: 100px;">Upload file:</label>
    <input type="file" name="trial_uploaded_file" id="trial_uploaded_file" encoding="multipart/form-data" />

    </form>

</div>
-->

<div class="modal fade" id="trial_upload_spreadsheet_info_dialog" name="trial_upload_spreadsheet_info_dialog" tabindex="-1" role="dialog" aria-labelledby="uploadTrialInfoDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="uploadTrialInfoDialog">Upload Template Information</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <&| /breeders_toolbox/trial/trial_spreadsheet_upload_format_info.mas &>
  	  </&>
	</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="trial_upload_spreadsheet_info_dialog" title="Format for uploading trials in a spreadsheet">
  <&| /breeders_toolbox/trial/trial_spreadsheet_upload_format_info.mas &>
  </&>
</div>
-->

<div class="modal fade" id="trial_upload_success_dialog_message" name="trial_upload_success_dialog_message" tabindex="-1" role="dialog" aria-labelledby="uploadTrialSuccessDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="uploadTrialSuccessDialog">Upload Successful</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <p>
    	  <span class="ui-icon ui-icon-circle-check" style="float: left; margin: 0 7px 50px 0;"></span>
    	  The trial file was uploaded successfully
  	  </p>
	</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--
<div id="trial_upload_success_dialog_message" title="Trial file uploaded">
  <p>
    <span class="ui-icon ui-icon-circle-check" style="float: left; margin: 0 7px 50px 0;"></span>
    The trial file was uploaded successfully
  </p>
</div>
-->